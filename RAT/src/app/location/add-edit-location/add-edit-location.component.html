<div class="page-container">
    <mat-card class="card-container">
        <mat-card-header>
            <span>{{!isEditMode ? 'Add' : 'Edit'}} location</span>
        </mat-card-header>

        <mat-divider></mat-divider>
        <form [formGroup]="addEditLocationForm">
            <mat-card-content class="account-text">
                <label class="field-name">Account</label><span class="star">*</span>
                <mat-form-field class="input-text-field">
                    <mat-label>Account</mat-label>
                    <input matInput placeholder="Account" name="name" formControlName="name" type="text" [(ngModel)]="location.name">
                    <mat-error *ngIf="addLocation.name.hasError">Please enter a name</mat-error>
                    <mat-hint class="error-message" *ngIf="errorMessage == uniqueNameError">{{errorMessage}}</mat-hint>
                </mat-form-field>
            </mat-card-content>

            <mat-card-content>
                <label class="field-name">Country</label><span class="star">*</span>
                <mat-form-field class="input-text-field">
                    <mat-label>Country</mat-label>
                    <input matInput placeholder="Country" name="country" formControlName="country" type="text" [(ngModel)]="location.country">
                    <mat-error *ngIf="addLocation.country.hasError">Please enter a country</mat-error>
                </mat-form-field>
            </mat-card-content>

            <mat-card-content>
                <label class="field-name">City</label><span class="star">*</span>
                <mat-form-field class="input-text-field">
                    <mat-label>City</mat-label>
                    <input matInput placeholder="City" name="city" formControlName="city" type="text" [(ngModel)]="location.city">
                    <mat-error *ngIf="addLocation.city.hasError">Please enter a city</mat-error>
                </mat-form-field>
            </mat-card-content>

            <mat-card-content>
                <label class="field-name">Address</label><span class="star">*</span>
                <mat-form-field class="input-text-field">
                    <mat-label>Address</mat-label>
                    <input matInput placeholder="Address" name="address" formControlName="address" type="text" [(ngModel)]="location.address">
                    <mat-error *ngIf="addLocation.address.hasError">Please enter an address</mat-error>
                </mat-form-field>
            </mat-card-content>

            <mat-card-content>
                <label class="field-name">Contact Email</label>
                <mat-form-field class="input-text-field">
                    <mat-label>Contact Email</mat-label>
                    <input type="email" matInput placeholder="email@xyz.abc" name="contactEmail" formControlName="contactEmail" class="form-input-field" [(ngModel)]="location.contactEmail"/>
                    <mat-error *ngIf="addLocation.contactEmail.hasError">Please enter a valid email address</mat-error>
                </mat-form-field>

                <mat-checkbox [checked]="!addEditLocationForm.value.resolved" [(ngModel)]="checked"
                    [ngModelOptions]="{standalone:true}"
                    (change)="addEditLocationForm.get('emailAlerts')?.setValue($event.checked)"
                    fromControlName="emailAlerts" class="email-checkbox" [(ngModel)]="location.emailAlertsActive">Email Alerts</mat-checkbox>
            </mat-card-content>

            <mat-card-content>
                <label class="field-name">Recipient Email</label>
                <mat-form-field class="input-text-field">
                    <mat-label>Recipient Email</mat-label>
                    <input type="email" matInput placeholder="email@xyz.abc" name="emailRecipient"
                        formControlName="emailRecipient" class="form-input-field" [(ngModel)]="location.emailRecipient"/>
                    <mat-error *ngIf="addLocation.emailRecipient.hasError">Please enter a valid email address
                    </mat-error>
                </mat-form-field>
            </mat-card-content>

            <mat-card-content>
                <label class="field-name">Latitude</label>
                <mat-form-field class="input-text-field">
                    <input matInput name="latitude" formControlName="latitude" type="text" [value]="this.initLat" [(ngModel)]="location.latitude">
                </mat-form-field>

                <label class="field-name">Longitude</label>
                <mat-form-field class="input-text-field">
                    <input matInput name="longitude" formControlName="longitude" type="text" [value]="this.initLng" [(ngModel)]="location.longitude">
                </mat-form-field>

                <app-map (latitudeEvent)="latitudeHandler($event)" (longitudeEvent)="longitudeHandler($event)" [lat]="location.latitude!" [lng]="location.longitude!">
                </app-map>
            </mat-card-content>

            <mat-card-actions class="buttons-container">
                <button (click)="addOrEditLocation()" 
                        mat-raised-button class="save-btn" 
                        [disabled]="!addEditLocationForm.valid">
                    Save {{isEditMode ? 'Changes' : ''}}
                </button>
                <button routerLink="/locations" mat-raised-button class="cancel-btn">Cancel</button>
            </mat-card-actions>
        </form>
    </mat-card>
</div>